(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{446:function(s,a,t){"use strict";t.r(a);var n=t(8),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("记录一次mysql的主从安装过程，本次安装版本为：5.7.26，以rpm的形式进行安装")]),s._v(" "),t("h2",{attrs:{id:"说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[s._v("#")]),s._v(" 说明")]),s._v(" "),t("p",[s._v("本次安装以root用户进行，建议为mysql专门建个用户进行安装运行\n机器ip信息 ：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("*.*.*.14")])]),s._v(" "),t("li",[t("code",[s._v("*.*.*.15")])])]),s._v(" "),t("h2",{attrs:{id:"开放端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开放端口"}},[s._v("#")]),s._v(" 开放端口")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("firewall-cmd --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp --permanent "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  firewall-cmd --reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"升级系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级系统"}},[s._v("#")]),s._v(" 升级系统")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("yum update -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /data/mysql-rpm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf /data/mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar -C /data/mysql-rpm "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解压")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y openssl-devel net-tools perl-JSON autoconf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装依赖")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -qa"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mariadb "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询是否安装了mariadb，如果安装了则需要卸载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#卸载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/mysql-rpm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh mysql-community-"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("common,libs,libs-compat,client,devel,server,embedded-compat,embedded-devel,embedded"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-5.7.26-1.el7.x86_64.rpm "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"创建数据目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建数据目录"}},[s._v("#")]),s._v(" 创建数据目录")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/mysql/data\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("20行："),t("code",[s._v("datadir=/data/mysql/data")])]),s._v(" "),t("li",[s._v("26行："),t("code",[s._v("log-error=/data/mysql/mysqld.log")])]),s._v(" "),t("li",[s._v("28行："),t("code",[s._v("lower_case_table_names=1")])])]),s._v(" "),t("h2",{attrs:{id:"初始化数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化数据库"}},[s._v("#")]),s._v(" 初始化数据库")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysqld --initialize --user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root --datadir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql/data --explicit_defaults_for_timestamp  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /data/mysql/*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl start  mysqld\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"查看默认密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看默认密码"}},[s._v("#")]),s._v(" 查看默认密码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'temporary password'")]),s._v(" /data/mysql/mysqld.log\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"修改默认密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改默认密码"}},[s._v("#")]),s._v(" 修改默认密码")]),s._v(" "),t("p",[s._v("使用默认密码登录后修改密码")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql -uroot -p\nALTER "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" IDENTIFIED BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*******'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"创建应用数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建应用数据库"}},[s._v("#")]),s._v(" 创建应用数据库")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create user test@'%' IDENTIFIED WITH 'mysql_native_password' BY '******';\ncreate database test CHARACTER SET utf8 COLLATE utf8_general_ci;\ngrant all privileges on test.* to test;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"配置主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置主从复制"}},[s._v("#")]),s._v(" 配置主从复制")]),s._v(" "),t("p",[s._v("以下操作需要连接数据库后操作")]),s._v(" "),t("ol",[t("li",[s._v("创建用于同步数据的账号")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("grant replication slave on *.* to "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'replicate'")]),s._v(" identified by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'********'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_14数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14数据库"}},[s._v("#")]),s._v(" 14数据库")]),s._v(" "),t("h4",{attrs:{id:"配置修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置修改"}},[s._v("#")]),s._v(" 配置修改")]),s._v(" "),t("p",[s._v("vim /etc/my.cnf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For advice on how to change settings please see")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("default_character_set")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncollation_server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" utf8mb4_general_ci\ncharacter_set_server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" utf8mb4\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove leading # and set to the amount of RAM for the most important data")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# innodb_buffer_pool_size = 128M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove leading # to turn on a very important data integrity option: logging")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# changes to the binary log between backups.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove leading # to set options mainly useful for reporting servers.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The server defaults are faster for transactions and fast SELECTs.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Adjust sizes as needed, experiment to find the optimal values.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# join_buffer_size = 128M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sort_buffer_size = 2M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# read_rnd_buffer_size = 2M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql/data\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql/mysql.sock\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Disabling symbolic-links is recommended to prevent assorted security risks")]),s._v("\nsymbolic-links"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nlog-error"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql/mysqld.log\npid-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/mysqld/mysqld.pid\n\n\nbinlog-format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mixed\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主标服务标识号,必需唯一")]),s._v("\nserver-id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略大小写")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lower_case_table_names")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录日志的数据库")]),s._v("\nbinlog-do-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不记录日志的库,即不需要同步的库")]),s._v("\n\nbinlog-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用从属服务器上的日志功能")]),s._v("\n\nlog-slave-updates\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#经过1日志写操作就把日志文件写入硬盘一次(对日志信息进行一次同步)。n=1是最安全的做法，但效率最低。默认设置是n=0。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sync_binlog")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# auto_increment，控制自增列AUTO_INCREMENT的行为")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# auto_increment_offset＝1设置步长,这里设置为1,这样Master的auto_increment字段产生的数值是:1, 3, 5, 7, …等奇数ID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_offset")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# auto_increment_increment=n有多少台服务器，n就设置为多少")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_increment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行镜像处理的数据库")]),s._v("\n\nreplicate-do-db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不进行镜像处理的数据库")]),s._v("\n\nreplicate-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br")])]),t("h4",{attrs:{id:"查看15数据库偏移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看15数据库偏移"}},[s._v("#")]),s._v(" 查看15数据库偏移")]),s._v(" "),t("p",[s._v("root账号进入15数据库查看偏移量")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show master status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000003 |      154 | test         | mysql            |                   |\n+------------------+----------+--------------+------------------+-------------------+\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"_14数据库设置同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14数据库设置同步"}},[s._v("#")]),s._v(" 14数据库设置同步")]),s._v(" "),t("p",[s._v("其中master_log_file和master_log_pos的值来源于另外一台数据库的偏移量结果")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("stop slave;\nchange master to master_host='*.*.*.15', master_user='replicate', master_password='*******', master_log_file='mysql-bin.000003', master_log_pos=154;\nstart slave;\nshow slave status\\G;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_15数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15数据库"}},[s._v("#")]),s._v(" 15数据库")]),s._v(" "),t("h4",{attrs:{id:"配置修改-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置修改-2"}},[s._v("#")]),s._v(" 配置修改")]),s._v(" "),t("p",[s._v("vim /etc/my.cnf")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For advice on how to change settings please see")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("default_character_set")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncollation_server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" utf8mb4_general_ci\ncharacter_set_server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" utf8mb4\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove leading # and set to the amount of RAM for the most important data")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# innodb_buffer_pool_size = 128M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove leading # to turn on a very important data integrity option: logging")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# changes to the binary log between backups.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Remove leading # to set options mainly useful for reporting servers.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The server defaults are faster for transactions and fast SELECTs.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Adjust sizes as needed, experiment to find the optimal values.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# join_buffer_size = 128M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sort_buffer_size = 2M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# read_rnd_buffer_size = 2M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datadir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql/data\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql/mysql.sock\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Disabling symbolic-links is recommended to prevent assorted security risks")]),s._v("\nsymbolic-links"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nlog-error"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql/mysqld.log\npid-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/mysqld/mysqld.pid\n\n\nbinlog-format"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mixed\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主标服务标识号,必需唯一")]),s._v("\nserver-id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略大小写")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lower_case_table_names")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录日志的数据库")]),s._v("\nbinlog-do-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不记录日志的库,即不需要同步的库")]),s._v("\n\nbinlog-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用从属服务器上的日志功能")]),s._v("\n\nlog-slave-updates\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#经过1日志写操作就把日志文件写入硬盘一次(对日志信息进行一次同步)。n=1是最安全的做法，但效率最低。默认设置是n=0。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sync_binlog")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# auto_increment，控制自增列AUTO_INCREMENT的行为")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# auto_increment_offset＝1设置步长,这里设置为1,这样Master的auto_increment字段产生的数值是:1, 3, 5, 7, …等奇数ID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_offset")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# auto_increment_increment=n有多少台服务器，n就设置为多少")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_increment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行镜像处理的数据库")]),s._v("\n\nreplicate-do-db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不进行镜像处理的数据库")]),s._v("\n\nreplicate-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br")])]),t("h4",{attrs:{id:"查看14数据库偏移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看14数据库偏移"}},[s._v("#")]),s._v(" 查看14数据库偏移")]),s._v(" "),t("p",[s._v("root账号进入14数据库查看偏移量")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show master status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000004 |  1258644 | test         | mysql            |                   |\n+------------------+----------+--------------+------------------+-------------------\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_15数据库设置同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15数据库设置同步"}},[s._v("#")]),s._v(" 15数据库设置同步")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("stop slave;\nchange master to master_host='*.*.*.14', master_user='replicate', master_password='********', master_log_file='mysql-bin.000004', master_log_pos=1258644;\nstart slave;\nshow slave status\\G;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);